# 補助記憶装置

# 目次
- [記録方法](#記録方法)
- [フラグメンテーション](#フラグメンテーション)
- [RAID](#raid)
- [リムーバブルメディア](#リムーバブルメディア)

# 記録方法
## 概要
ディスクを使用する前に、 ** フォーマット ** を行いディスク上に記録領域を作成する。  
** ディスク（プラッタ） ** の上に磁性体が塗布されており、 ** アクセスアーム ** の先端についている ** 磁気ヘッド ** がその磁性体の向きを読んだり書き込んだりすることでデータにアクセスする。
## 記録領域
ディスクは ** トラック ** という同心円状の記録領域の単位を複数集めた構成になっている。  
トラックは扇状に ** セクタ ** という単位にさらに分割することができる。  
縦に積まれた複数のディスクの同じ位置のトラックをまとめて ** シリンダ ** と呼ぶことができる。

記録領域のサイズは、  
``シリンダ数 * 1シリンダ毎のトラック数 * 1トラック毎のセクタ数 * 1セクタの記録容量``  
で求めることができる。

OSは複数のセクタをまとめた ** クラスタ ** という単位でデータの読み書きを行う。  
クラスタ内で使われなかった領域は、他のデータでも使えず無駄な領域になってしまう。
## データへのアクセス
データへのアクセスは、
1. シーク（アクセスアームが磁気ヘッドをデータのある位置まで運ぶ）
2. サーチ（データが磁気ヘッドの位置まで回ってくるのを待つ）
3. データ転送（セクタに書き込まれたデータを読み込む）  

の手順で行われる。
シーク~サーチまでの時間を** 待ち時間 ** 、シーク~データ転送までの時間を ** アクセス時間 ** と呼ぶ。

# フラグメンテーション
## 概要
ファイルを書き込むときは、シークやサーチにかかる時間を減らすため、基本的に一つのファイルを連続した領域に書き込む。  
しかしファイルを書き込んだり消したりを繰り返していくと、徐々に空き容量の飛び地ができたり大きな空き容量の領域が確保できなくなっていく。  
そうすると、大きなファイルを書き込むときには一つのファイルを飛び飛びのセクタに書き込まなければならなくなったりしてアクセス時間が長くかかるようになってしまう。  
この状態をファイルが断片化してしまっていることから ** フラグメンテーション ** と呼ぶ。
## フラグメンテーションの解消
断片化されたファイルを連続した領域に保存できるように整理することを ** デフラグメンテーション（デフラグ） ** と呼ぶ。

# RAID
## 概要
複数のハードディスクを纏めて、論理的に一つのハードディスクとして扱う技術をディスクアレイと呼ぶ。  
その実装手段の一つとして、 ** RAID ** と呼ばれるものがある。  
RAIDは高速化や信頼性の向上を目的として使用され、要求要件に応じて ** RAID0 ~ RAID6 ** までの7種類に分かれている。  
主に使われているのは 高速化目的の RAID0, 信頼性目的の RAID1, そしてそれらを両立した？ RAID5 の3種類。

### RAID0
RAID0は、1つのデータを複数のハードディスクに分けて書き込んでいる。これを ** ストライピング ** と呼ぶ。1つのデータを分割して並列に処理するので、その分高速化できる。RAID0はデータをブロック単位でストライピングしている。

### RAID1
RAID1は、複数のハードディスク全てに同じデータを書き込んでいる。これを ** ミラーリング ** と呼ぶ。  
複数のハードディスクに同じデータを書き込むので冗長で利用できるデータ量が減ってしまうが、全てのハードディスクが壊れない限り問題無いため信頼性が高い。

### RAID10（RAID1+0 または RAID0+1）
RAID0とRAID1を組み合わせた方式。ストライピングしたハードディスクの組をミラーリングしたり、その逆を行ったりして速度と信頼性を両立する。

### RAID2
RAID2は、データをビット単位でストライピングする。また、それとは別のディスクにメモリなどで使われる** 誤り訂正符号（ECC: Error Correction Code） ** というものを書き込む。これによってデータの冗長性を確保する。  
ただし、代表的なECCである ** ハミング符号 ** と呼ばれるものは計算に時間がかかり、ディスクの利用効率も低いため製品としては殆ど使用されない。

### RAID3, 4
RAID3は、データをビット単位でストライピングする。RAID4はデータをブロック単位でストライピングする。  
どちらもRAID2と同じように別のディスクに冗長コードを書き込むが、RAID3, 4ではECC(ハミング符号)ではなく ** パリティ ** と呼ばれるものを使用する。  
こちらもディスクの利用効率が低く、製品としてはほぼRAID5が実装されている。

### RAID5
RAID5は、データをブロック単位でストライピングする。冗長コードとしてはパリティが採用されているが、RAID3, 4とは違い、パリティを書き込むディスクは決まっておらず、他のデータと同様に全ディスクに分散して記録される。  
そのため、どれか一つのハードディスクが壊れても他のハードディスクのデータとパリティから壊れたディスクの元データが復元できる。  

ディスクが何枚であっても、パリティの保存に必要なのはディスク1枚分の容量だけなのでディスクが多いほどディスクの使用効率が高まる。  
また、読み出し時は複数ディスクから並列に読み出せるので高速。  
書き込み時はパリティの計算・生成が必要で、生成には一旦ディスクからデータを読み出す必要があるらしく速度は速くないらしい。

### RAID6
RAID5を拡張したもので、パリティを同時に2種類書き込むことでディスクが同時に2台壊れてもデータを復元できる。

# リムーバブルメディア
## 概要
ハードディスクなどと違い、比較的簡単に取り外しができる補助記憶装置を ** リムーバブルメディア ** と呼ぶ。  
用途としては、データのバックアップや配布などの目的で使用される。

### フロッピーディスク
磁気でデータを記録する。耐久性に難があり、保存容量も1MB程度しかないため、画像や音声を保存する必要が出てきてからはほとんど使用されなくなっている。

### 光ディスク
セクタが同心円状に並んでいたハードディスクと違い、らせん状に並んでいるのが特徴。データをレーザー光線によって書きこみ、反射でデータを読み取る。
#### CD
直径12cmで、650MBか700MBの保存容量を持つ。安くて容量がそこそこあるので、データの配布目的で主に使用される。  
- CD-ROM - 製造時にディスク上にピットと呼ばれる微細な凹凸を作りデータを記録する。凹凸の有無でレーザーの反射率が違うので、それでデータを読み取らせる。使用者はデータを書き込めず、読み込み専用である。
- CD-R - 使用者が1度だけデータを書き込めるCDで、記録層に有機塗料が塗られておりそれをレーザーで焦がすことでピット（凹凸）を作る仕組みになっている。
- CD-RW - 使用者が何度でもデータを書き込めるCDで、記録層に相変化金属という材料を使っている。レーザーを照射することで結晶化、非結晶化させることができ、それによる反射率の差でデータを読み取る。

#### DVD
基本的な仕組みはCDと同じで、レーザーに波長の短い赤色光線を使うことでピットを高密度化させデータ容量を増やしている。
記録層が1層か2層か、片面か両面かで記録容量に差がある。  

片面1層 - 4.7GB, 片面2層 - 8.5GB, 両面1層 - 9.4GB, 両面2層 - 17GB  

- DVD-ROM - 再生用のDVD
- DVD-R - 追記用のDVD
- DVD-RW, DVD-RAM - 書き換え可能型のDVD

#### 光磁気ディスク（MO: Magnet Optical Disk）
レーザ光線で記録面を熱してから、磁気を使ってデータを保存するメディア。読み込むときはレーザ光線を使用する。  
フロッピーディスクの後継として出てきて、光ディスクの高容量低価格化によって廃れた。

#### 磁気テープ
VHSとかで使われている、磁気を使ってデータの読み書きを行うカセット型の記憶媒体。アクセス速度が遅い代わりに大容量という特徴があるらしい。  
ブロックごとにスタート、ストップしたりせず連続でデータの読み書きを行うものをストリーマと呼ぶ。

#### フラッシュメモリ
主記憶装置に使うPROM（Programmable ROM）の一種を補助記憶装置として転用したもの。  
SDカードやUSBメモリなどがある。小さくて低価格なのでデータの持ち運び目的に使われる。  

#### SSD
ハードディスクの代替として注目されている。  
仕組みとしてはフラッシュメモリを集積したようなもので、先述のRAIDのような仕組みで高速化がなされていたりする。  
また、ハードディスクと違い機械的な機構ではないのでシークやサーチなども発生しないのも理由としてある。衝撃などにも強い。  
ただし書き込み可能な回数が決まっており、ハードディスクより価格も高いので現時点では相互互換的なものになっている。

